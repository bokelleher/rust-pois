<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/><title>POIS Tools — SCTE‑35 Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/static/app.css"><script src="/static/app.js" defer></script>
</head><body>
<header class="topbar">
  <div class="brand"><a href="/"><span class="logo">POIS</span></a><a href="/static/admin.html" class="brand-sub">Admin</a></div>
  <nav class="nav">
  <a href="/static/admin.html">Channels & Rules</a>
  <a href="/static/tools.html">SCTE‑35 Builder</a>
  <a href="/static/events.html">Event Monitor</a>
</nav>
  <div class="spacer"></div><div class="right row"><span id="tokenDisplay">token: unset</span><button class="btn" id="logoutBtn">Logout</button></div>
</header>
<main class="content" style="max-width:980px;margin:24px auto;">
  <h1>SCTE‑35 Builder</h1>
  <div class="card">
    <div class="row" style="gap:12px;flex-wrap:wrap">
      <label for="tokenInput">Bearer token:</label>
      <input id="tokenInput" type="text" placeholder="dev-token" style="min-width:220px">
      <button id="saveTokenBtn" class="btn">Save</button>
    </div>
    <hr style="border:none;border-top:1px solid var(--border);margin:12px 0">
    <div class="row" style="gap:12px;flex-wrap:wrap">
      <label for="cmd">Command</label>
      <select id="cmd"><option value="time_signal_immediate">Time Signal (immediate)</option><option value="splice_insert_out">Splice Insert OUT (auto‑return)</option></select>
      <label for="dur">Duration (s)</label><input id="dur" type="number" min="0" step="1" value="60" style="width:100px">
      <button id="buildBtn" class="btn-primary">Build</button><span id="status" class="small"></span>
    </div>
    <div class="row" style="gap:12px;margin-top:10px;flex-wrap:wrap"><input id="b64" type="text" style="flex:1" readonly><button class="btn" id="copyB64">Copy</button></div>
  </div>
  <p class="small">API: POST <code>/api/tools/scte35/build</code> (requires Authorization: Bearer).</p>
</main>
<script>
(function(){
  const tokInput=document.getElementById('tokenInput');
  const saveBtn=document.getElementById('saveTokenBtn');
  const cmd=document.getElementById('cmd');
  const dur=document.getElementById('dur');
  const btn=document.getElementById('buildBtn');
  const out=document.getElementById('b64');
  const status=document.getElementById('status');
  const copyB64=document.getElementById('copyB64');
  document.addEventListener('DOMContentLoaded', ()=>{ tokInput.value = POIS_TOKEN.get(); });
  saveBtn.addEventListener('click', ()=>{ POIS_TOKEN.set(tokInput.value.trim()); status.textContent='token saved.'; });
  btn.addEventListener('click', async ()=>{
    const token=POIS_TOKEN.get(); if(!token){ status.textContent='Missing token'; return; }
    status.textContent='Building…'; const body={ command: cmd.value }; if(cmd.value==='splice_insert_out') body.duration_s=Number(dur.value)||0;
    try{
      const r=await fetch('/api/tools/scte35/build',{ method:'POST', headers:{ 'Content-Type':'application/json','Authorization':'Bearer '+token }, body: JSON.stringify(body) });
      if(!r.ok){ throw new Error(await r.text() || ('HTTP '+r.status)); }
      const data=await r.json(); out.value=data.scte35_b64||''; status.textContent='OK';
    }catch(e){ status.textContent='Error: '+e.message; }
  });
  copyB64.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(out.value||''); status.textContent='Copied.'; }catch(e){ status.textContent='Copy failed.'; } });
})();
</script>
</body></html>
